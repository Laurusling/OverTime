<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025年12月加班费计算器（适配新格式）</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }
        .input-area {
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            resize: vertical;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .leave-input {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .leave-input label {
            width: 150px;
            font-size: 16px;
            color: #4a5568;
        }
        .leave-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
        }
        .leave-input span {
            margin-left: 10px;
            color: #718096;
        }
        button {
            background-color: #4299e1;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #3182ce;
        }
        .result-area {
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        .stat-item {
            font-size: 16px;
            margin: 10px 0;
            color: #2d3748;
        }
        .stat-item strong {
            color: #4299e1;
        }
        .level {
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
            color: #e53e3e;
            text-align: center;
        }
        /* 日历表样式 */
        .calendar-area {
            margin: 40px 0;
        }
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-type {
            display: flex;
            gap: 10px;
        }
        .type-btn {
            padding: 8px 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .type-btn.active {
            background-color: #4299e1;
            color: white;
            border-color: #4299e1;
        }
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
        }
        .calendar-table th, .calendar-table td {
            border: 1px solid #dee2e6;
            padding: 15px;
            text-align: center;
        }
        .calendar-table th {
            background-color: #e8f4f8;
            color: #2d3748;
        }
        .calendar-table td {
            background-color: white;
        }
        .workday {
            background-color: #e8f4f8 !important;
        }
        .weekend {
            background-color: #fdf2f8 !important;
        }
        .holiday {
            background-color: #fef7fb !important;
            color: #e53e3e;
        }
        .overtime {
            font-weight: bold;
            color: #48bb78;
        }
        /* 使用说明样式 */
        .usage-area {
            margin: 40px 0;
            padding: 20px;
            background-color: #f5fafe;
            border-radius: 6px;
        }
        .usage-area h3 {
            text-align: left;
            margin-bottom: 15px;
        }
        .usage-list {
            list-style: decimal;
            padding-left: 20px;
            color: #4a5568;
            line-height: 1.8;
        }
        .usage-list li {
            margin-bottom: 10px;
        }
        .usage-list strong {
            color: #2d3748;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>2025年12月加班费计算器（适配新格式）</h1>

        <!-- 输入区域 -->
        <div class="input-area">
            <h2>数据输入</h2>
            <textarea id="attendanceData" placeholder="请粘贴考勤查询的打卡数据（复制控制台预览中的值）"></textarea>
            
            <div class="leave-input">
                <label for="personalLeave">本月事假时长（小时）：</label>
                <input type="number" id="personalLeave" min="0" step="0.5" value="0">
                <span>（1小时扣20元，支持小数，如1.5小时）</span>
            </div>

            <button id="calculateBtn">计算加班费</button>
        </div>

        <!-- 统计结果区域 -->
        <div class="result-area">
            <h2>本月加班统计</h2>
            <div class="stat-item">本月平时加班时间：<strong id="weekdayOvertime">0</strong> 小时（<strong id="weekdayOvertimeMin">0</strong> 分钟）</div>
            <div class="stat-item">本月周末加班时间：<strong id="weekendOvertime">0</strong> 小时（<strong id="weekendOvertimeMin">0</strong> 分钟）</div>
            <div class="stat-item">本月法定节假日加班时间：<strong id="holidayOvertime">0</strong> 小时（<strong id="holidayOvertimeMin">0</strong> 分钟）</div>
            <div class="stat-item">本月加班费：<strong id="overtimeSalary">0</strong> 元</div>
            <div class="stat-item">本月事假扣减费：<strong id="leaveDeduction">-0</strong> 元</div>
            <div class="stat-item">本月总加班费：<strong id="totalSalary">0</strong> 元</div>
            <div class="level" id="level">鉴定级别：待计算</div>
        </div>

        <!-- 加班费日历表区域 -->
        <div class="calendar-area">
            <h2>2025年12月加班费日历表（点击格子切换状态）</h2>
            <div class="calendar-controls">
                <div>
                    <span>日期状态切换：点击日历格子可循环切换「工作日」→「周末」→「法定节假日」</span>
                </div>
            </div>
            <table class="calendar-table" id="overtime-calendar">
                <thead>
                    <tr>
                        <th>周一</th>
                        <th>周二</th>
                        <th>周三</th>
                        <th>周四</th>
                        <th>周五</th>
                        <th>周六</th>
                        <th>周日</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="workday" data-date="1" data-type="workday">1<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="2" data-type="workday">2<br><span class="overtime-rate">平时加班：84.48元/小时</span></td>
                        <td class="workday" data-date="3" data-type="workday">3<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="4" data-type="workday">4<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="5" data-type="workday">5<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="weekend" data-date="6" data-type="weekend">6<br><span class="overtime-rate">周末加班：100.32元/小时</span></td>
                        <td class="weekend" data-date="7" data-type="weekend">7<br><span class="overtime-rate">周末加班：100.32元/小时</span></td>
                    </tr>
                    <tr>
                        <td class="workday" data-date="8" data-type="workday">8<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="9" data-type="workday">9<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="10" data-type="workday">10<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="11" data-type="workday">11<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="12" data-type="workday">12<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="weekend" data-date="13" data-type="weekend">13<br><span class="overtime-rate">周末加班：100.32元/小时</span></td>
                        <td class="weekend" data-date="14" data-type="weekend">14<br><span class="overtime-rate">周末加班：100.32元/小时</span></td>
                    </tr>
                    <tr>
                        <td class="workday" data-date="15" data-type="workday">15<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="16" data-type="workday">16<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="17" data-type="workday">17<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="18" data-type="workday">18<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="19" data-type="workday">19<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="weekend" data-date="20" data-type="weekend">20<br><span class="overtime-rate">周末加班：100.32元/小时</span></td>
                        <td class="weekend" data-date="21" data-type="weekend">21<br><span class="overtime-rate">周末加班：100.32元/小时</span></td>
                    </tr>
                    <tr>
                        <td class="workday" data-date="22" data-type="workday">22<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="23" data-type="workday">23<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="24" data-type="workday">24<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="holiday" data-date="25" data-type="holiday">25<br><span class="overtime-rate">节假日加班：150.48元/小时</span></td>
                        <td class="holiday" data-date="26" data-type="holiday">26<br><span class="overtime-rate">节假日加班：150.48元/小时</span></td>
                        <td class="holiday" data-date="27" data-type="holiday">27<br><span class="overtime-rate">节假日加班：150.48元/小时</span></td>
                        <td class="workday" data-date="28" data-type="workday">28<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                    </tr>
                    <tr>
                        <td class="workday" data-date="29" data-type="workday">29<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="workday" data-date="30" data-type="workday">30<br><span class="overtime-rate">平时加班：75.24元/小时</span></td>
                        <td class="holiday" data-date="31" data-type="holiday">31<br><span class="overtime-rate">节假日加班：150.48元/小时</span></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 使用说明区域 -->
        <div class="usage-area">
            <h3>使用方法</h3>
            <ol class="usage-list">
                <li>在电脑上使用<strong>谷歌浏览器（Chrome）</strong>或<strong>Edge浏览器</strong>打开公司考勤系统（QHR）。</li>
                <li>按<strong>F12</strong>打开开发者工具，切换到「网络」（Network）标签页。</li>
                <li>在考勤系统中点击「个人考勤查询」，加载2025年12月打卡数据。</li>
                <li>在开发者工具的「网络」面板中，找到名称类似「alist!2CXvv_JQ9M03QhX8PGCgxw.220302」的请求项（类型为XHR/Fetch）。</li>
                <li>点击该项，切换到「预览」（Preview）标签，找到打卡数据数组（包含CARDTIME、SHIFTTERM等字段），右键点击「复制值」（Copy value）。</li>
                <li>将复制的JSON格式数据粘贴到本页面的「打卡数据输入框」中。</li>
                <li>在「本月事假时长」输入框中填写实际请假小时数（支持小数，如1.5小时）。</li>
                <li>点击日历格子可切换日期状态（工作日→周末→法定节假日，循环切换），系统会自动适配对应加班费标准。</li>
                <li>点击「计算加班费」按钮，即可查看统计结果和详细加班数据。</li>
                <li><strong>重要提示：</strong>所有数据仅在本地浏览器中处理，绝不上传至任何服务器，隐私安全有保障！</li>
            </ol>
        </div>
    </div>

    <script>
        // 配置参数（适配2025年12月加班费标准，从日历表提取）
        const CONFIG = {
            // 时薪标准（根据日历表反推，确保加班费计算准确）
            HOURLY_WAGE: 50.16, // 基础时薪：平时加班75.24=50.16×1.5，周末100.32=50.16×2，节假日150.48=50.16×3
            // 加班倍数（劳动法标准）
            OVERTIME_RATIO: {
                weekday: 1.5,    // 平时加班1.5倍
                weekend: 2,      // 周末加班2倍
                holiday: 3       // 法定节假日3倍
            },
            // 事假扣费标准（1小时20元）
            LEAVE_DEDUCTION_PER_HOUR: 20,
            // 2025年12月法定节假日（元旦）
            HOLIDAYS_2025_12: ['2025-12-25', '2025-12-26', '2025-12-27', '2025-12-31']
        };

        // 全局变量
        let attendanceList = [];  // 格式化后的打卡数据列表

        // DOM元素
        const $attendanceData = document.getElementById('attendanceData');
        const $personalLeave = document.getElementById('personalLeave');
        const $calculateBtn = document.getElementById('calculateBtn');
        const $weekdayOvertime = document.getElementById('weekdayOvertime');
        const $weekdayOvertimeMin = document.getElementById('weekdayOvertimeMin');
        const $weekendOvertime = document.getElementById('weekendOvertime');
        const $weekendOvertimeMin = document.getElementById('weekendOvertimeMin');
        const $holidayOvertime = document.getElementById('holidayOvertime');
        const $holidayOvertimeMin = document.getElementById('holidayOvertimeMin');
        const $overtimeSalary = document.getElementById('overtimeSalary');
        const $leaveDeduction = document.getElementById('leaveDeduction');
        const $totalSalary = document.getElementById('totalSalary');
        const $level = document.getElementById('level');
        const $calendarCells = document.querySelectorAll('#overtime-calendar td[data-date]');

        // 初始化
        init();

        function init() {
            // 日历格子点击切换状态
            $calendarCells.forEach(cell => {
                cell.addEventListener('click', () => {
                    const currentType = cell.dataset.type;
                    // 循环切换：workday→weekend→holiday→workday
                    let newType = '';
                    let newClass = '';
                    let rateText = '';
                    let rate = 0;

                    if (currentType === 'workday') {
                        newType = 'weekend';
                        newClass = 'weekend';
                        rate = 100.32; // 周末加班费率
                        rateText = `周末加班：${rate}元/小时`;
                    } else if (currentType === 'weekend') {
                        newType = 'holiday';
                        newClass = 'holiday';
                        rate = 150.48; // 节假日加班费率
                        rateText = `节假日加班：${rate}元/小时`;
                    } else {
                        newType = 'workday';
                        newClass = 'workday';
                        rate = 75.24; // 平时加班费率（12月1日特殊84.48，单独处理）
                        if (cell.dataset.date === '2') rate = 84.48; // 12月2日特殊费率
                        rateText = `平时加班：${rate}元/小时`;
                    }

                    // 更新单元格状态
                    cell.dataset.type = newType;
                    cell.className = newClass;
                    cell.innerHTML = `${cell.dataset.date}<br><span class="overtime-rate">${rateText}</span>`;
                });
            });

            // 计算按钮点击事件
            $calculateBtn.addEventListener('click', calculateOvertime);
        }

        /**
         * 解析打卡数据（适配CARDTIME格式）
         * 核心逻辑：按日期分组，提取每日最早打卡=上班时间，最晚打卡=下班时间
         * @returns {Array} 格式化后的打卡数据
         */
        function parseAttendanceData() {
            try {
                const rawData = JSON.parse($attendanceData.value.trim());
                if (!Array.isArray(rawData)) throw new Error('数据格式错误，应为数组');
                if (rawData.length === 0) throw new Error('打卡数据为空');

                // 按日期分组（SHIFTTERM字段为日期）
                const dateGroup = {};
                rawData.forEach(item => {
                    const date = item.SHIFTTERM; // 日期（YYYY-MM-DD）
                    const cardTime = item.CARDTIME; // 打卡时间（YYYY-MM-DD HH:mm:ss）
                    
                    if (!dateGroup[date]) {
                        dateGroup[date] = [];
                    }
                    dateGroup[date].push(cardTime);
                });

                // 格式化每组数据：提取最早/最晚打卡时间作为上下班时间
                const formattedData = [];
                Object.keys(dateGroup).forEach(date => {
                    const cardTimes = dateGroup[date];
                    // 排序打卡时间，获取最早（上班）和最晚（下班）
                    cardTimes.sort();
                    const checkIn = cardTimes[0].split(' ')[1]; // 上班时间（HH:mm:ss）
                    const checkOut = cardTimes[cardTimes.length - 1].split(' ')[1]; // 下班时间（HH:mm:ss）
                    
                    // 计算当日加班时长（小时）
                    const overtimeHours = calculateDailyOvertime(date, checkIn, checkOut);
                    
                    // 判断日期类型（从日历格子获取当前状态，支持手动切换后的数据同步）
                    const dateType = getDateTypeFromCalendar(date);
                    
                    // 计算当日加班费（根据日历格子的费率，确保精准）
                    const dailySalary = calculateDailySalary(date, overtimeHours, dateType);
                    
                    formattedData.push({
                        date,
                        week: getWeekday(date),
                        dateType,
                        dateTypeText: getDateTypeText(dateType),
                        checkIn,
                        checkOut,
                        overtimeHours: parseFloat(overtimeHours.toFixed(2)),
                        dailySalary: parseFloat(dailySalary.toFixed(2))
                    });
                });

                return formattedData.filter(item => item.overtimeHours >= 0);
            } catch (e) {
                alert(`数据解析失败：${e.message}\n请检查粘贴的打卡数据格式是否正确`);
                return [];
            }
        }

        /**
         * 从日历格子获取当前日期类型（支持手动切换状态同步）
         * @param {string} date 日期（YYYY-MM-DD）
         * @returns {string} 类型：weekday/weekend/holiday
         */
        function getDateTypeFromCalendar(date) {
            const day = date.split('-')[2]; // 提取日（DD）
            const cell = document.querySelector(`#overtime-calendar td[data-date="${day}"]`);
            return cell ? cell.dataset.type : 'weekday'; // 默认工作日
        }

        /**
         * 计算当日加班费（根据日历表显示的费率，确保和视觉一致）
         * @param {string} date 日期（YYYY-MM-DD）
         * @param {number} overtimeHours 加班时长（小时）
         * @param {string} dateType 日期类型
         * @returns {number} 当日加班费
         */
        function calculateDailySalary(date, overtimeHours, dateType) {
            const day = date.split('-')[2];
            const cell = document.querySelector(`#overtime-calendar td[data-date="${day}"]`);
            if (!cell) return 0;

            // 从日历格子提取当前费率（支持手动切换后费率同步）
            const rateText = cell.querySelector('.overtime-rate').textContent;
            const rate = parseFloat(rateText.match(/(\d+\.\d+)/)[1]);
            return overtimeHours * rate;
        }

        /**
         * 计算当日加班时长（小时）
         * 标准工作时间：9:00-18:00（8小时），超出部分算加班
         * @param {string} date 日期（YYYY-MM-DD）
         * @param {string} checkIn 上班时间（HH:mm:ss）
         * @param {string} checkOut 下班时间（HH:mm:ss）
         * @returns {number} 加班时长（小时）
         */
        function calculateDailyOvertime(date, checkIn, checkOut) {
            if (!checkIn || !checkOut) return 0;

            // 标准工作时间：9:00-18:00（8小时）
            const standardStart = new Date(`${date} 09:00:00`).getTime();
            const standardEnd = new Date(`${date} 18:00:00`).getTime();
            const actualStart = new Date(`${date} ${checkIn}`).getTime();
            const actualEnd = new Date(`${date} ${checkOut}`).getTime();

            // 实际工作时长（毫秒）
            const actualWorkMs = actualEnd - actualStart;
            const actualWorkHours = actualWorkMs / (1000 * 60 * 60);

            // 加班时长 = 实际工作时长 - 标准8小时（最低0）
            let overtimeHours = Math.max(0, actualWorkHours - 8);

            // 特殊规则：早到不算加班，晚退才算（如9:30上班，18:30下班，实际工作9小时，加班1小时）
            const lateHours = actualStart > standardStart ? (actualStart - standardStart) / (1000 * 60 * 60) : 0;
            overtimeHours = Math.max(0, overtimeHours - lateHours);

            return overtimeHours;
        }

        /**
         * 获取星期文本
         * @param {string} date 日期（YYYY-MM-DD）
         * @returns {string} 星期文本（如：星期一）
         */
        function getWeekday(date) {
            const weekDays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            const dateObj = new Date(date);
            return weekDays[dateObj.getDay()];
        }

        /**
         * 获取日期类型文本
         * @param {string} type 类型：weekday/weekend/holiday
         * @returns {string} 文本描述
         */
        function getDateTypeText(type) {
            const typeMap = {
                weekday: '工作日',
                weekend: '周末',
                holiday: '法定节假日'
            };
            return typeMap[type] || '未知';
        }

        /**
         * 计算总加班费和统计数据
         */
        function calculateOvertime() {
            // 解析打卡数据
            attendanceList = parseAttendanceData();
            if (attendanceList.length === 0) return;

            // 计算各类型加班总时长
            const weekdayTotal = attendanceList
                .filter(item => item.dateType === 'weekday')
                .reduce((sum, item) => sum + item.overtimeHours, 0);
            const weekendTotal = attendanceList
                .filter(item => item.dateType === 'weekend')
                .reduce((sum, item) => sum + item.overtimeHours, 0);
            const holidayTotal = attendanceList
                .filter(item => item.dateType === 'holiday')
                .reduce((sum, item) => sum + item.overtimeHours, 0);

            // 转换为分钟
            const weekdayMin = Math.round(weekdayTotal * 60);
            const weekendMin = Math.round(weekendTotal * 60);
            const holidayMin = Math.round(holidayTotal * 60);

            // 计算总加班费（从每日加班费求和，确保精准）
            const overtimeSalaryTotal = attendanceList
                .reduce((sum, item) => sum + item.dailySalary, 0)
                .toFixed(2);

            // 计算事假扣减费
            const leaveHours = parseFloat($personalLeave.value) || 0;
            const leaveDeduction = (leaveHours * CONFIG.LEAVE_DEDUCTION_PER_HOUR).toFixed(2);

            // 计算最终总加班费
            const totalSalary = (overtimeSalaryTotal - leaveDeduction).toFixed(2);

            // 更新统计结果
            $weekdayOvertime.textContent = weekdayTotal.toFixed(2);
            $weekdayOvertimeMin.textContent = weekdayMin;
            $weekendOvertime.textContent = weekendTotal.toFixed(2);
            $weekendOvertimeMin.textContent = weekendMin;
            $holidayOvertime.textContent = holidayTotal.toFixed(2);
            $holidayOvertimeMin.textContent = holidayMin;
            $overtimeSalary.textContent = overtimeSalaryTotal;
            $leaveDeduction.textContent = `-${leaveDeduction}`;
            $totalSalary.textContent = totalSalary;

            // 计算鉴定级别
            calculateLevel(totalSalary);
        }

        /**
         * 计算鉴定级别
         * @param {number} total 总加班费
         */
        function calculateLevel(total) {
            const totalNum = parseFloat(total);
            let levelText = '';
            let levelColor = '';

            if (totalNum < 300) {
                levelText = '你在干什么？';
                levelColor = '#e53e3e';
            } else if (totalNum < 500) {
                levelText = '还行';
                levelColor = '#ed8936';
            } else if (totalNum < 1000) {
                levelText = '一般，建议多加点，冲1000！';
                levelColor = '#f6ad55';
            } else if (totalNum <= 1500) {
                levelText = '牛逼';
                levelColor = '#48bb78';
            } else if (totalNum < 2000) {
                levelText = '逆天';
                levelColor = '#38b2ac';
            } else {
                levelText = '你是懂加班的';
                levelColor = '#9f7aea';
            }

            $level.textContent = `鉴定级别：${levelText}`;
            $level.style.color = levelColor;
        }

        /**
         * 获取星期文本
         * @param {string} date 日期（YYYY-MM-DD）
         * @returns {string} 星期文本
         */
        function getWeekday(date) {
            const weekMap = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            return weekMap[new Date(date).getDay()];
        }
    </script>
</body>
</html>
